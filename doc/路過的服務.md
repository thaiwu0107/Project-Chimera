# Project Chimera â€” Hop-by-Hop åŸ·è¡Œè¦æ ¼è£œéº

**å¯¦ä½œé€²åº¦ï¼š0/12 æœå‹™å·²å®Œæˆ (0%)**

ä¸‹é¢æ˜¯ä¸€ä»½**ã€Œé€ç«™æ˜ç¢ºå‹•ä½œ & å…¥åº«/å…¥ Redis æ™‚æ©Ÿã€è£œå……è¦æ ¼**ã€‚
ç›®çš„ï¼šç•¶ä»»ä½•è«‹æ±‚/äº‹ä»¶ã€Œåˆ°é”æŸå€‹æœå‹™ã€æ™‚ï¼Œå·¥ç¨‹è©²**åšä»€éº¼**ã€**è®€ä»€éº¼**ã€**ç®—ä»€éº¼**ã€**å¯«å“ªè£¡**ã€**ç™¼å“ªå€‹äº‹ä»¶**ï¼Œä¸€æ­¥åˆ°ä½ã€‚

## 0) è¨˜è™Ÿ & é€šç”¨è¦å‰‡

* æ™‚é–“ï¼šepoch msï¼›é‡‘é¡ï¼šUSDTï¼›æ¯”ä¾‹å°æ•¸ï¼ˆ0.1=10%ï¼‰ã€‚
* é…ç½®ï¼šæ‰€æœ‰æ¥­å‹™è®€ `config_active.rev`ï¼›æ”¶åˆ° `cfg:events` å¾Œ RCU ç†±è¼‰ã€‚
* Redisï¼ˆClusterï¼‰ï¼šä½¿ç”¨**å“ˆå¸Œæ¨™ç±¤**å›ºå®šåˆ†ç‰‡ï¼Œä¾‹å¦‚ï¼š`risk:{budget}:fut_margin:inuse`ã€`lock:{pos}:<pos_id>`ã€‚
* å†ªç­‰éµï¼š`intent_id`ï¼ˆä¸‹å–®/åˆ†ç‰‡ï¼‰ã€`client_order_id`ï¼ˆäº¤æ˜“æ‰€å±¤ï¼‰ã€`signal_id`ã€`(signal_id,horizon)`ï¼ˆæ¨™ç±¤ï¼‰ã€`transfer_id`ï¼ˆåŠƒè½‰ï¼‰ã€`trade_id`ï¼ˆå¾©ç›¤ï¼‰ã€‚
* é–ï¼š`lock:{pos}:<pos_id>`ã€`lock:{treasury}:<from>:<to>`ã€`lock:{router}:param:update` ç­‰ï¼ŒTTL å¿…è¨­ã€‚

---

## A) Per-Serviceã€Œåˆ°ç«™å°±åšã€æ¸…å–®

### S1 â€” Exchange Connectorsï¼ˆè¡Œæƒ…/å¸³æˆ¶/åŠƒè½‰ï¼‰âŒ **[æœªå¯¦ä½œ]**

**äº‹ä»¶ä¾†æº â†’ åˆ° S1 æ™‚è¦åš**

1. **WS è¡Œæƒ…/æ·±åº¦/Ticker/Funding æ›´æ–°**

   * è®€ï¼šç„¡ï¼ˆç›´é€£äº¤æ˜“æ‰€ï¼‰
   * ç®—ï¼šæ¸…æ´—/æ™‚é–“å°é½Šï¼›æ‹¼ `mid`ã€`spread_bp`ï¼›å¯åšæœ€å°ç¯€æµï¼ˆå»æŠ–ï¼‰
   * å¯« Redis Streamï¼š

     * `mkt:events:{spot}:<SYMBOL>`ï¼ˆç¾è²¨ï¼‰
     * `mkt:events:{perp}:<SYMBOL>`ï¼ˆæ°¸çºŒï¼‰
     * `mkt:events:{funding}:<SYMBOL>`ï¼ˆä¸‹ä¸€æœŸ/å¯¦éš› fundingï¼‰
   * å¯« DBï¼ˆåƒ… funding å¯¦æ”¶ï¼‰ï¼š`funding_records`ï¼ˆ`symbol,funding_time,rate,amount_usdt`ï¼‰
   * æŒ‡æ¨™ï¼š`metrics:events:s1.ws_rtt`ã€`s1.mkt_throughput`

2. **POST /xchg/treasury/transferï¼ˆå…§éƒ¨ï¼‰**

   * é©—ï¼šIdempotency-Key / `transfer_id`ï¼›é™é¡/ç™½åå–®
   * å«äº¤æ˜“æ‰€åŠƒè½‰ API â†’ åˆ¤å®šæˆåŠŸ/å¤±æ•—
   * å¯« DBï¼š`treasury_transfers`ï¼ˆç‹€æ…‹æµè½‰ï¼‰
   * ç™¼äº‹ä»¶ï¼š`ops:events`ï¼ˆå¯©è¨ˆï¼‰
   * å›ï¼š`TransferResponse{TransferID,Result,Message}`

---

### S2 â€” Feature Generatorï¼ˆç‰¹å¾µ/Regimeï¼‰âŒ **[æœªå¯¦ä½œ]**

**åˆ° S2 æ™‚è¦åš**

1. **æ¶ˆè²» `mkt:events:*`**

   * è®€ï¼šæ»‘çª—å¿«å– `feat:{cache}:<symbol>`ã€`config_active.rev`
   * ç®—ï¼šATR/RV/Ï/Spread/Depth ç­‰ï¼›DQC æ¨™è¨˜
   * å¯« DBï¼š`signals`ï¼ˆæ–°/è£œå¯« `features`ã€`t0`ã€`config_rev`ï¼‰
   * ç™¼äº‹ä»¶ï¼š`feat:events:<symbol>`ï¼ˆå« `signal_id,t0,symbol,features`ï¼‰

2. **æ¯æ—¥ Regimeï¼ˆæ’ç¨‹ï¼‰**

   * ç®—ï¼šRV ç™¾åˆ†ä½ï¼›æ¨™ç±¤ FROZEN/NORMAL/EXTREME
   * å¯« Redis KVï¼š`prod:{regime}:market:state`ï¼ˆå¸¶ `rev` èˆ‡éæœŸæ™‚é–“æˆ³ï¼‰
   * æŒ‡æ¨™ï¼š`metrics:events:s2.regime_latency`

3. **POST /features/recompute**

   * è®€ï¼šæœŸé–“ K ç·š/æ·±åº¦ï¼ˆè³‡æ–™æ¹–/äº¤æ˜“æ‰€ï¼‰
   * ç®—ï¼šè£œç®—ç‰¹å¾µ
   * å¯« DBï¼šå›è£œ `signals.features`ï¼›å¯« `strategy_events(kind=FEATURE_RECOMPUTE)`

---

### S3 â€” Strategy Engineï¼ˆå®ˆé–€/è¦å‰‡/æ¨¡å‹/æ„åœ–ï¼‰âŒ **[æœªå¯¦ä½œ]**

**åˆ° S3 æ™‚è¦åš**

1. **æ¥ `feat:events:<symbol>` æˆ– `/decide`**

   * è®€ï¼š`prod:{kill_switch}`ï¼›`config_active.rev` & bundleï¼›é¢¨éšªé…é¡ï¼ˆRedisï¼‰ï¼›`funding:{next}:<symbol>`ï¼›å¥åº· `prod:{health}:system:state`
   * å®ˆé–€ L0ï¼šKillSwitchã€äº¤æ˜“æ™‚çª—ã€ä¿è­‰é‡‘/ä½µç™¼ï¼ˆè¦‹ S3 é¢¨éšªéµï¼‰
   * L1 è¦å‰‡ DSLï¼šæŒ‰ `priority` åˆæˆ `skip_entry/size_mult/tp_mult/sl_mult/max_adds_override`
   * L2 æ¨¡å‹ï¼šè¶…æ™‚å›é€€ï¼›æ˜ å°„ `size_mult`
   * ç”¢æ±ºç­–ï¼š`Decision{action=open|skip, size_mult,â€¦, reason}`
   * å¯« DBï¼š`signals.decision`ï¼ˆå« `model_p`ã€`reason`ã€`config_rev`ï¼‰
   * ç™¼äº‹ä»¶ï¼š`sig:events`ï¼ˆæ±ºç­–å¿«ç…§ï¼‰
   * è‹¥ `open`ï¼šçµ„ `OrderIntent{market=FUT|SPOT,â€¦,intent_id}` â†’ å‘¼ S4 `/orders`

2. **é¢¨éšªéµï¼ˆRedisï¼›åŸå­ï¼‰**

   * `risk:{budget}:fut_margin:inuse`ï¼ˆUSDT åŠ ç¸½ï¼‰ï¼›`risk:{concurrency}:<symbol>`ï¼ˆä½µç™¼æ•¸ï¼‰
   * é€šéâ†’æš«å ï¼›å¤±æ•—â†’`decision.skip(reason=RISK_BUDGET)`

---

### S4 â€” Order Routerï¼ˆè·¯ç”±/TWAP/OCO/æ’¤å–®ï¼‰âŒ **[æœªå¯¦ä½œ]**

**åˆ° S4 æ™‚è¦åš**

1. **POST /ordersï¼ˆå« FUT/ SPOT / TWAP / OCO / GuardStopï¼‰**

   * é©—ï¼š`intent_id` å†ªç­‰ï¼›KillSwitchï¼ˆæ–°å€‰ç¦ï¼‰
   * è®€ï¼šè·¯ç”±åƒæ•¸ `router:{param}:curves`ï¼›æœ€æ–°åƒ¹/æ·±åº¦ï¼ˆRedis å¿«ç…§ï¼‰
   * æ±ºç­–ï¼šMakerâ†’Taker æˆ– TWAPï¼›SPOT æ˜¯å¦åŸç”Ÿ OCOï¼›å®ˆè­·åœæéœ€è¦æ™‚å•Ÿå‹•ç›£æ§
   * ä¸‹å–®ï¼šç”¢ `client_order_id`ï¼›REST/WS ä¸‹ç™¼
   * å¯« DBï¼š`orders`ï¼ˆNEW/éƒ¨åˆ†/FILLEDï¼‰ï¼›`fills`ï¼ˆå« `mid_at_send/top3/slippage_bps`ï¼‰
   * å¯« Redisï¼š

     * SPOT å®ˆè­·ï¼š`guard:{stop}:<symbol>:<intent_id>`ï¼ˆarmed/armed\_atï¼‰
     * TWAP ä½‡åˆ—ï¼š`prod:{exec}:twap:queue`ï¼ˆZSetï¼›`score=due_ts`ï¼‰
     * æˆäº¤æµï¼š`ord:{results}`ï¼ˆStreamï¼›åŒ¯ç¸½çµ¦ S6/S5ï¼‰
   * å›ï¼š`OrderResult{status, order_id, filled_avg, â€¦}`

2. **POST /cancel**

   * é©—ï¼šå†ªç­‰ï¼›è®€ç¾æ³
   * åŸ·è¡Œï¼šæ’¤å–®ï¼›å¿…è¦æ™‚å‡ç´šç‚ºå¸‚åƒ¹é¨°æŒª
   * å¯« DBï¼š`orders(status=CANCELED)`ï¼›äº‹ä»¶ `strategy_events(kind=CANCEL)`
   * ç™¼ï¼š`ord:{results}`ï¼ˆæ’¤å–®å›å ±ï¼‰

3. **TWAP tickï¼ˆæ’ç¨‹ï¼‰**

   * å– ZSet åˆ°æœŸä»»å‹™ â†’ ä¾åºåˆ‡ç‰‡ä¸‹å–® â†’ æœªå®Œå†å…¥åˆ—
   * æŒ‡æ¨™ï¼š`router_p95`ã€`maker_timeout_count`

---

### S5 â€” Reconcilerï¼ˆå°å¸³/å­¤å…’è™•ç½®ï¼‰âŒ **[æœªå¯¦ä½œ]**

**åˆ° S5 æ™‚è¦åš**

1. **POST /reconcileï¼ˆALL|ORDERS|POSITIONSï¼‰**

   * æ‹‰ï¼šäº¤æ˜“æ‰€ `openOrders/positionRisk`ï¼›DB `orders/positions_snapshots`
   * ç®—ï¼šé›†åˆå·®ç•°ï¼ˆJaccardã€ä¸€è‡´ç‡ï¼‰
   * è™•ç½®ï¼šå­¤å…’æ›å–®â†’S4 `/cancel`ï¼›æ•¸é‡ä¸ç¬¦â†’ä»¥äº¤æ˜“æ‰€ç‚ºæº–ä¿® DB æˆ–é€²ä¿å®ˆé™é¢¨éšªï¼ˆå°é¡å¸‚åƒ¹ï¼‰
   * å¯« DBï¼š`strategy_events(kind=RECONCILE_*)`ï¼›åŒæ­¥ `orders/positions_snapshots`
   * å¯« Redisï¼š`recon:{last_run_ts}`ï¼›åš´é‡æ™‚ `alerts(ERROR)`ã€å¥åº·é™ç´šä¿¡è™Ÿ

---

### S6 â€” Position Managerï¼ˆåœæ/æ­¢ç›ˆ/åŠ å€‰/è³‡é‡‘ï¼‰âŒ **[æœªå¯¦ä½œ]**

**åˆ° S6 æ™‚è¦åš**

1. **POST /positions/manage** æˆ– **ç®¡ç† tickï¼ˆæ’ç¨‹ï¼‰**

   * è®€ï¼šæœ€æ–°åƒ¹ã€ATRã€Regimeï¼›`pos` ç•¶å‰ SL/TP éšï¼›åŠ å€‰ä¸Šé™ï¼›å¥åº·åº¦
   * ç®—ï¼šROEã€å¼·å¹³è·é›¢ï¼›æ˜¯å¦ä¸Šå‡é–åˆ©éšï¼›æ˜¯å¦å‘½ä¸­æ­¢ç›ˆï¼›æ˜¯å¦åŠ å€‰
   * è¡Œå‹•ï¼š

     * é–åˆ©ï¼š`/cancel` èˆŠ SL â†’ `/orders` æ–° SLï¼ˆreduceOnlyï¼‰
     * æ­¢ç›ˆï¼š`/orders` å¸‚åƒ¹ reduceOnlyï¼ˆåˆ†æ‰¹ï¼‰
     * åŠ å€‰ï¼š`/orders` æ–°å–®ï¼›æ›´æ–° `add_on_count`
   * å¯« DBï¼š`positions_snapshots`ï¼ˆæ–°å¿«ç…§ï¼‰ï¼›`orders/fills`ï¼ˆç”± S4 å›å ±ï¼‰
   * å¯« Redisï¼š`pos:{sl}:level:<pos_id>`ã€`pos:{tp}:ladder:<pos_id>`ã€`pos:{adds}:<pos_id>`
   * é‡‹æ”¾é…é¡ï¼šå€‰ä½é—œé–‰æ™‚ `risk:{budget}`/`risk:{concurrency}` åå‘èª¿æ•´

2. **è‡ªå‹•è³‡é‡‘åŠƒè½‰ï¼ˆæ’ç¨‹ï¼‰**

   * è®€ï¼šSPOT/FUT å¯ç”¨é¤˜é¡
   * ç®—ï¼š`need=max(0,min_free_fut-free_fut)`
   * è‹¥è¶³â†’é€  `transfer_id`ï¼Œå¯« DB `treasury_transfers(PENDING)` â†’ è«‹ S12 å¯©æ‰¹ â†’ S1 åŸ·è¡Œ
     ï¼ˆè‹¥å•Ÿç”¨å…¨è‡ªå‹•ï¼Œå¯ç›´é€£ S1ï¼‰

---

### S7 â€” Label Backfillï¼ˆ12/24/36hï¼‰âŒ **[æœªå¯¦ä½œ]**

**åˆ° S7 æ™‚è¦åš**

1. **POST /labels/backfill?h=â€¦**

   * æŸ¥ï¼š`signals` æ»¿è¶³ `t0+H<=now` & ç„¡ `labels_H`
   * èšåˆï¼šè©²äº¤æ˜“çª—å£å…§ `fills`ã€`funding_records`ã€è²»ç”¨
   * ç®—ï¼š`ROI_net(H)`ã€`label`
   * å¯« DBï¼š`labels_12h/24h/36h`ï¼ˆUpsertï¼‰ï¼›`strategy_events(kind=LABEL_WRITE)`
   * ç™¼ï¼š`labels:{ready}`ï¼ˆå¯é¸ Streamï¼›è§¸ç™¼ Autopsyï¼‰

---

### S8 â€” Autopsy Generatorï¼ˆå¾©ç›¤ï¼‰âŒ **[æœªå¯¦ä½œ]**

**åˆ° S8 æ™‚è¦åš**

1. **POST /autopsy/{trade\_id}`** æˆ– **ç›£è½ `pos\:events(EXIT|STAGNATED)\`**

   * æ‹‰ï¼š`signals/orders/fills/positions_snapshots/funding_records/labels_*`
   * ç®—ï¼šROE æ›²ç·šã€TCA/æ»‘åƒ¹ã€Peer åˆ†ä½ã€åäº‹å¯¦ã€æ•˜äº‹æ‘˜è¦
   * å¯« DBï¼š`autopsy_reports{trade_id,...}`ï¼›ç‰©ä»¶å­˜ MinIO `autopsy/<trade_id>.html|pdf`
   * ç™¼ï¼š`strategy_events(kind=AUTOPSY_DONE)`ï¼›æŒ‡æ¨™ `s8.autopsy_latency`

---

### S9 â€” Hypothesis Orchestratorï¼ˆå¯¦é©—/å›æ¸¬ï¼‰âŒ **[æœªå¯¦ä½œ]**

**åˆ° S9 æ™‚è¦åš**

1. **POST /experiments/run**

   * è®€ï¼š`hypotheses` é¸ PENDINGï¼›é…ç½®æ¨£æœ¬çª—å£/Walk-Forward
   * è·‘ï¼šå›æ¸¬å¼•æ“ï¼ˆå¯é›¢ç·šæ‰¹ï¼‰â†’ KPI/æª¢å®š/FDR
   * å¯« DBï¼š`experiments`ï¼ˆçµæœï¼‰ã€`hypotheses(status=CONFIRMED|REJECTED)`
   * ç™¼ï¼š`ops:events` é€šçŸ¥/å¯©è¨ˆ

---

### S10 â€” Config Serviceï¼ˆLint/æ¨¡æ“¬/æ•æ„Ÿåº¦/Promoteï¼‰âŒ **[æœªå¯¦ä½œ]**

**åˆ° S10 æ™‚è¦åš**

1. **POST /bundles** â†’ Lint â†’ Dry-runï¼ˆè¿‘ N å¤© `signals` é‡æ”¾ï¼‰
2. **POST /simulate** â†’ å·®ç•°ä¼°ç®— + æ•æ„Ÿåº¦ï¼ˆÂ±Îµ æ“¾å‹•ï¼‰
3. **POST /promote** â†’ å¯« DBï¼š`promotions`ã€åˆ‡ `config_active`ã€ç™¼ `cfg:events`
4. **GET /active** â†’ å› `bundle_id,rev`ï¼ˆä¾›å„æœå‹™å•Ÿå‹•/ç†±è¼‰ï¼‰

---

### S11 â€” Metrics & Healthï¼ˆå½™æ•´/å®ˆé–€ï¼‰âŒ **[æœªå¯¦ä½œ]**

**åˆ° S11 æ™‚è¦åš**

1. **æ”¶ `metrics:events:*` & æ‹‰é—œéµæŒ‡æ¨™**

   * èšåˆï¼šå¯« DB `metrics_timeseries/strategy_metrics_daily`
   * åˆ¤ç­‰ç´šï¼šç¶œåˆ `maker_fill_ratio / ib_rate / AUC / Brier / router_p95 / stream_lag`
   * å¯« Redisï¼š`prod:{health}:system:state=GREEN|YELLOW|ORANGE|RED`
   * ç™¼å‘Šè­¦ï¼š`alerts`ï¼ˆDB + é€šçŸ¥ï¼‰

2. **GET /metrics, /alerts** â†’ æä¾›å‰ç«¯é¢æ¿

---

### S12 â€” Web UI / API GWï¼ˆä»£ç†/RBAC/Kill-switchï¼‰âŒ **[æœªå¯¦ä½œ]**

**åˆ° S12 æ™‚è¦åš**

1. **ä»£ç†å¾Œç«¯ API**ï¼šé©—ç¥¨/RBAC â†’ è½‰ç™¼ â†’ å›å‚³
2. **POST /kill-switch**ï¼šè¨­ `prod:{kill_switch}=ON`ï¼ˆTTLï¼‰ï¼›ç™¼ `ops:events`ï¼›å„æ ¸å¿ƒæœå‹™è®€æ­¤æ——æ¨™æ‹’æ–°å€‰
3. **POST /treasury/transfer**ï¼šå»ºç«‹/å¯©æ‰¹åŠƒè½‰è«‹æ±‚ â†’ å…§å‘¼ S1

---

## B) ä»£è¡¨æ€§æµç¨‹ï¼šé€ç«™è¡Œç‚º + å…¥åº«/å…¥ Redis æ˜ç´°

> è¡¨é ­ï¼š**Step | Service | Input | Validate/Read | Compute | Write DB | Write Redis | Next**

### B1) FUT å…¥å ´ï¼ˆå« SL/TP æ›å–®ï¼‰âŒ **[æœªå¯¦ä½œ]**

1. **S3**ï½œ`feat:events` or `/decide`ï½œè®€ `config_active, kill_switch, risk:*`ï½œL0/L1/L2 â†’ `open` & `OrderIntent(FUT, intent_id)`ï½œå¯« `signals.decision`ï½œç™¼ `sig:events`ï½œâ†’ **S4**
2. **S4**ï½œ`POST /orders`ï¼ˆå¸‚åƒ¹ï¼‰ï½œå†ªç­‰/è·¯ç”±åƒæ•¸ï½œä¸‹å¸‚åƒ¹ï¼Œæ”¶ `FILL` èšåˆå‡åƒ¹ï½œå¯« `orders(FILLED), fills`ï½œ`ord:{results}`ï½œâ†’ **S6**
3. **S6**ï½œ`ord:{results}` or ç®¡ç† tickï½œè®€ ATR/Regime/é…ç½®ï½œç®— SL/TP åƒ¹ï½œâ€”ï½œâ€”ï½œå‘¼ **S4** æ› `STOP_MARKET/TP`ï¼ˆreduceOnlyï¼‰
4. **S4**ï½œ`POST /orders`ï¼ˆå…©è…¿ï¼‰ï½œå†ªç­‰ï½œæ›å–®ï½œå¯« `orders(NEW)`ï½œ`ord:{results}`ã€`strategy_events(TP_SL_PLACED)`ï½œâ†’ å®Œæˆ

### B2) SPOT å…¥å ´ï¼ˆOCO æˆ– GuardStopï¼‰âŒ **[æœªå¯¦ä½œ]**

1. **S3**ï½œåŒä¸Š â†’ `OrderIntent(SPOT, exec=OCO|GUARD)`ï½œåŒä¸Šï½œå¯« `signals.decision`ï½œ`sig:{events}`ï½œâ†’ **S4**
2. **S4(OCO)**ï½œ`POST /orders`ï½œæª¢ OCO æ”¯æ´ï½œåŸç”Ÿ OCO ä¸‹å–®ï½œå¯« `orders/`å­è…¿ `fills`ï½œ`ord:{results}`ï½œâ†’ å®Œæˆ
3. **S4(Guard)**ï½œ`POST /orders` `LIMIT_MAKER`ï½œâ€”ï½œä¸‹é™åƒ¹ï¼›ç›£æ§è§¸åƒ¹â†’å…ˆæ’¤å†å®ˆè­·/åæ‰‹ç­–ç•¥ï½œå¯« `orders/`å®ˆè­·ç‹€æ…‹ï½œ`guard:{stop}:<symbol>:<intent_id>`ï½œâ†’ å®Œæˆ

### B3) Trailing Stop / åˆ†æ‰¹æ­¢ç›ˆ / åŠ å€‰ âŒ **[æœªå¯¦ä½œ]**

1. **S6**ï½œç®¡ç† tickï½œè®€åƒ¹/ATR/Regime/æŒå€‰ç‹€æ…‹ï½œåˆ¤æ–·å‡éš/TP/åŠ å€‰ï½œå¯« `positions_snapshots`ï½œ`pos:{sl}/ {tp}/ {adds}`ï½œâ†’ **S4**
2. **S4**ï½œ`/cancel` èˆŠ SL â†’ `/orders` æ–° SL / TP / åŠ å€‰ï½œæª¢å†ªç­‰ï½œåŸ·è¡Œï½œå¯« `orders/fills`ï½œ`ord:{results}`ï½œâ†’ **S6** æ›´æ–°/é‡è©•

### B4) å°å¸³è™•ç½® âŒ **[æœªå¯¦ä½œ]**

1. **S12**ï½œ`POST /reconcile`ï½œRBACï½œâ€”ï½œâ€”ï½œâ€”ï½œâ€”ï½œâ†’ **S5**
2. **S5**ï½œå°å¸³ï½œè®€äº¤æ˜“æ‰€/DBï½œé›†åˆé›†åˆå·®ç•° & ç­–ç•¥ï½œä¿® DBã€å¿…è¦æ™‚å‘¼ **S4** æ’¤å–®/å¹³å€‰ï½œå¯« `strategy_events`ã€ä¿® `orders/positions`ï½œ`alerts`ã€`recon:{last_run_ts}`ï½œâ†’ å®Œæˆ

### B5) æ¨™ç±¤å›å¡« & å¾©ç›¤ âŒ **[æœªå¯¦ä½œ]**

1. **S7**ï½œ`/labels/backfill?h=24`ï½œâ€”ï½œèšåˆ PnL/è²»ç”¨/Funding â†’ `ROI_net`/labelï½œå¯« `labels_24h`ï½œ`labels:{ready}`ï¼ˆå¯é¸ï¼‰ï½œâ†’ **S8**
2. **S8**ï½œ`/autopsy/{trade_id}` or ç›£è½ `pos:{events}`ï½œâ€”ï½œç®— TCA/Peer/åäº‹å¯¦/æ•˜äº‹ï½œå¯« `autopsy_reports` + MinIOï½œ`strategy_events(AUTOPSY_DONE)`ï½œâ†’ å®Œæˆ

### B6) é…ç½®æ¨¡æ“¬ + æ•æ„Ÿåº¦ + æ¨å»£ âŒ **[æœªå¯¦ä½œ]**

1. **S12**â†’**S10**ï½œ`/bundles`ï½œLint/Dry-runï½œâ€”ï½œå¯« `config_bundles`ï½œâ€”ï½œâ†’ **S10**
2. **S10**ï½œ`/simulate`ï½œâ€”ï½œé‡æ”¾å·®ç•° & Â±Îµ æ•æ„Ÿåº¦ï½œå¯« `simulations`ï½œâ€”ï½œâ†’ **S12**
3. **S12**â†’**S10**ï½œ`/promote`ï½œå®ˆé–€/Canary/Rampï½œåˆ‡ `config_active`ã€è¨˜ `promotions`ï½œå¯« `config_active/promotions`ï½œç™¼ `cfg:{events}`ï½œâ†’ å„æœå‹™ç†±è¼‰

### B7) é¢¨éšªé ç®—/ä½µç™¼å®ˆé–€ âŒ **[æœªå¯¦ä½œ]**

1. **S3**ï½œæ±ºç­–å…¥å ´å‰ï½œåŸå­ `INCR/INCRBY`ï½œæª¢å‰©é¤˜é¡åº¦ï½œâ€”ï½œè‹¥ä¸è¶³ï¼šå¯« `signals.decision.skip=RISK_BUDGET`ï½œâ€”ï½œâ†’ å¦æ±ºæˆ–æ”¾è¡Œ
2. **S6/S5**ï½œé—œé–‰å€‰ä½ï½œâ€”ï½œé‡‹æ”¾é¡åº¦ `DECR/DECRBY`ï½œâ€”ï½œâ€”ï½œâ€”ï½œâ†’ å®Œæˆ

### B8) é‡‘åº«åŠƒè½‰ï¼ˆè‡ªå‹•/äººå·¥ï¼‰âŒ **[æœªå¯¦ä½œ]**

1. **S6**ï½œé¤˜é¡ä¸è¶³åˆ¤å®šï½œâ€”ï½œè¨ˆç®— `need` â†’ é€  `transfer_id`ï½œå¯« `treasury_transfers(PENDING)`ï½œ`lock:{treasury}`ï½œâ†’ **S12**
2. **S12**ï½œå¯©æ‰¹ â†’ **S1**ï½œé©—/å‘¼äº¤æ˜“æ‰€â†’çµæœï½œæ›´æ–° `treasury_transfers` ç‹€æ…‹ï½œ`ops:{events}`ï½œâ†’ å®Œæˆ

### B9) å¥åº·é™ç´š â†’ ç­–ç•¥è¡Œç‚ºèª¿åƒ âŒ **[æœªå¯¦ä½œ]**

1. **S11**ï½œå½™ç¸½ï½œâ€”ï½œåˆæˆå¥åº·ç­‰ç´šï½œå¯« `metrics_timeseries`ï½œ`prod:{health}:system:state`ï½œâ†’ å…¨æœå‹™
2. **S3/S4/S6**ï½œè®€å¥åº·ç­‰ç´šï½œâ€”ï½œå¥—ç”¨çŸ©é™£ï¼ˆ`size_mult`â†“ã€`maker_wait`â†‘ã€å¸‚åƒ¹æ¯”ä¾‹â†‘ï¼‰ï½œâ€”ï½œâ€”ï½œâ†’ å½±éŸ¿å¾ŒçºŒæ±ºç­–/åŸ·è¡Œ

### B10) æˆæœ¬å­¸ç¿’ â†’ è·¯ç”±åƒæ•¸å†ä¼° âŒ **[æœªå¯¦ä½œ]**

1. **S11**ï½œæœˆæ‰¹ï½œâ€”ï½œæ“¬åˆ `slip_bps = g(spread,depth,vol,regime)`ï½œå¯« `experiments` æˆ– `config_bundles` è‰ç¨¿ï½œ`router:{param}:curves(draft)`ï½œâ†’ **S10** å®ˆé–€
2. **S10**ï½œæ¨¡æ“¬/Promoteï½œâ€”ï½œâ€”ï½œå¯« `config_active`ï½œ`cfg:{events}`ï½œâ†’ S4 ç†±è¼‰æ–°åƒæ•¸

---

## C) åˆ°ç«™è¦å¯«å“ªè£¡ï¼ˆé€ŸæŸ¥è¡¨ï¼‰âŒ **[å…¨éƒ¨æœªå¯¦ä½œ]**

| æœå‹™  | **DB Collections**ï¼ˆå¯«å…¥æ™‚æ©Ÿï¼‰                                                      | **Redis Key/Stream**ï¼ˆå¯«å…¥æ™‚æ©Ÿï¼‰                                                  | å¯¦ä½œç‹€æ…‹ |
| --- | ----------------------------------------------------------------------------- | --------------------------------------------------------------------------- | ---- |
| S1  | `funding_records`ï¼ˆæ”¶åˆ°å¯¦æ”¶ï¼çµç®—æ™‚ï¼‰; `treasury_transfers`ï¼ˆåŸ·è¡Œçµæœï¼‰                       | \`mkt\:events:{spot                                                         | perp | funding}:<sym>`ï¼ˆå³æ™‚ï¼‰; `ops\:events\`ï¼ˆå¯©è¨ˆï¼‰ | âŒ **[æœªå¯¦ä½œ]** |
| S2  | `signals(features,t0,config_rev)`ï¼ˆæ–°/è£œç®—ï¼‰; `strategy_events(FEATURE_RECOMPUTE)` | `feat:events:<sym>`ï¼ˆæ–°ç‰¹å¾µï¼‰; `prod:{regime}:market:state`ï¼ˆæ¯æ—¥ï¼‰                  | âŒ **[æœªå¯¦ä½œ]** |
| S3  | `signals.decision`ï¼ˆæ¯æ¬¡æ±ºç­–ï¼‰                                                      | `sig:events`ï¼ˆæ±ºç­–å¿«ç…§ï¼‰ï¼›`risk:{budget}*`ã€`risk:{concurrency}*`ï¼ˆå…¥å ´å ç”¨/é‡‹æ”¾ï¼‰          | âŒ **[æœªå¯¦ä½œ]** |
| S4  | `orders`ï¼ˆæ‰€æœ‰ç‹€æ…‹ï¼‰; `fills`ï¼ˆæ¯ç­†æˆäº¤æµï¼‰; `strategy_events(TP_SL_PLACED/CANCEL)`        | `ord:{results}`ï¼ˆå­/çˆ¶å–®çµæœï¼‰ï¼›`prod:{exec}:twap:queue`ï¼ˆTWAPï¼‰ï¼›`guard:{stop}:*`ï¼ˆå®ˆè­·ï¼‰ | âŒ **[æœªå¯¦ä½œ]** |
| S5  | `strategy_events(RECONCILE_*)`ï¼›ä¿® `orders/positions_snapshots`                 | `recon:{last_run_ts}`ï¼›`alerts`ï¼ˆéŒ¯èª¤ï¼‰                                          | âŒ **[æœªå¯¦ä½œ]** |
| S6  | `positions_snapshots`ï¼ˆæ¯ tick/äº‹ä»¶ï¼‰                                              | `pos:{sl}:level:*`ã€`pos:{tp}:ladder:*`ã€`pos:{adds}:*`ï¼›é‡‹æ”¾ `risk:{*}`         | âŒ **[æœªå¯¦ä½œ]** |
| S7  | `labels_12h/24h/36h`ï¼ˆUpsertï¼‰; `strategy_events(LABEL_WRITE)`                  | `labels:{ready}`ï¼ˆå¯é¸ï¼‰ï¼›`labels:{last_backfill_ts}`                            | âŒ **[æœªå¯¦ä½œ]** |
| S8  | `autopsy_reports`ï¼ˆUpsertï¼‰                                                     | â€”ï¼ˆæˆ– `ops:events` é€šçŸ¥ï¼‰                                                        | âŒ **[æœªå¯¦ä½œ]** |
| S9  | `experiments`ï¼›`hypotheses(status)`                                            | `bt:{last_run_ts}`                                                          | âŒ **[æœªå¯¦ä½œ]** |
| S10 | `config_bundles`ã€`simulations`ã€`promotions`ã€`config_active`                   | `cfg:{events}`ï¼ˆæ¨å»£ï¼‰                                                          | âŒ **[æœªå¯¦ä½œ]** |
| S11 | `metrics_timeseries`ã€`strategy_metrics_daily`ã€`alerts`                        | `prod:{health}:system:state`                                                | âŒ **[æœªå¯¦ä½œ]** |
| S12 | `treasury_transfers`ï¼ˆå¯©æ‰¹ï¼‰                                                      | `prod:{kill_switch}`ï¼›`ops:events`                                           | âŒ **[æœªå¯¦ä½œ]** |

---

## ğŸ“Š å¯¦ä½œé€²åº¦ç¸½çµ

### âŒ å…¨éƒ¨æœªå¯¦ä½œ (0%)
- **S1-S12**ï¼šæ‰€æœ‰æœå‹™å‡æœªå¯¦ä½œ
- **B1-B10**ï¼šæ‰€æœ‰æµç¨‹å‡æœªå¯¦ä½œ
- **C é€ŸæŸ¥è¡¨**ï¼šæ‰€æœ‰è³‡æ–™å¯«å…¥å‡æœªå¯¦ä½œ

### ğŸ¯ å»ºè­°å„ªå…ˆé †åº
1. **S1 Exchange Connectors** - äº¤æ˜“æ‰€é€šä¿¡åŸºç¤
2. **S2 Feature Generator** - ç‰¹å¾µè¨ˆç®—å¼•æ“
3. **S3 Strategy Engine** - æ±ºç­–é‚è¼¯æ ¸å¿ƒ
4. **S4 Order Router** - è¨‚å–®åŸ·è¡Œæ ¸å¿ƒ
5. **S6 Position Manager** - æŒå€‰æ²»ç†
6. **S5 Reconciler** - å°å¸³è™•ç½®
7. **S12 API Gateway** - çµ±ä¸€å…¥å£
8. **S10 Config Service** - é…ç½®ç®¡ç†
9. **S11 Metrics & Health** - ç›£æ§ç³»çµ±
10. **S7-S9** - åˆ†æã€ç ”ç©¶æœå‹™

---

é€™ä»½è£œéºæŠŠ**æ¯å€‹ã€Œè·¯éçš„æœå‹™ã€**åœ¨**åˆ°ç«™æ™‚**å¿…åšçš„æ ¡é©—ã€è®€å–ã€è¨ˆç®—ã€å¯«å…¥ï¼ˆ**å“ªå€‹ Collection/å“ªå€‹ Redis Key/å“ªå€‹ Stream**ï¼‰èˆ‡**ä¸‹ä¸€è·³**éƒ½æ˜ç¢ºäº†ã€‚
å·¥ç¨‹å¯ä»¥ç›´æ¥ä¾æ­¤è½åœ°**è™•ç†å™¨éª¨æ¶**ï¼ˆhandler/consumer skeletonï¼‰ã€**äº‹å‹™é‚Šç•Œ**ï¼ˆå†ªç­‰ & é–ï¼‰èˆ‡**å¥‘ç´„æ¸¬è©¦**ã€‚
