# Project Chimera åŠŸèƒ½è¦æ ¼æ›¸

**å¯¦ä½œé€²åº¦ï¼š0/12 æœå‹™å·²å®Œæˆ (0%)**

## 0) è®€æˆ‘

- âŒ **æ™‚é–“æˆ³**ï¼šä¸€å¾‹ epoch ms **[S1-S3æœªå¯¦ä½œ]**
- âŒ **é‡‘é¡**ï¼šUSDT **[S1-S3æœªå¯¦ä½œ]**
- âŒ **ç™¾åˆ†æ¯”**ï¼šç”¨å°æ•¸ï¼ˆ0.10 = 10%ï¼‰**[S1-S3æœªå¯¦ä½œ]**

æ‰€æœ‰æœå‹™å‡æä¾› `GET /health`ï¼Œå›å‚³ `HealthResponse`ï¼ˆå·²åœ¨ `internal/apispec/spec.go` å®šç¾©ï¼‰ã€‚

æ–‡å…§å‹åˆ¥çš†å¼•ç”¨ä½ ç¾æœ‰çš„ `spec.go`ï¼šå¦‚ `DecideRequest/Response`ã€`OrderCmdRequest/Result` ç­‰ã€‚

äº‹ä»¶æµæ¡ Redis Streamsï¼ˆå‘½åè¦å‰‡å·²åœ¨ç™½çš®æ›¸ v3 è¨‚å¦¥ï¼‰ï¼Œæœ¬æ–‡èšç„¦ HTTP ä»‹é¢çš„äº’å‹•ï¼›é‡åˆ°ã€Œäº‹ä»¶/è³‡æ–™ã€ä»¥ Streams äº¤æ›è€…ï¼Œä»¥ã€”Stream: â€¦ã€•æ¨™è¨»ã€‚

**å¯¦ä½œç‹€æ…‹**ï¼š
- âŒ **S1-S12 æ‰€æœ‰æœå‹™**ï¼šExchange Connectorsã€Feature Generatorã€Strategy Engineã€Order Routerã€Reconcilerã€Position Manager ç­‰ **[æœªå¯¦ä½œ]**

## 1) äº’å‹•çŸ©é™£ï¼ˆèª°å‘¼å«èª°ã€ç”¨å“ªæ¢ APIï¼‰

| è¡Œç‚º/æƒ…å¢ƒ | Caller â†’ Callee | Endpoint | Request å‹åˆ¥ | Response å‹åˆ¥ | å‚™è¨» | å¯¦ä½œç‹€æ…‹ |
|-----------|-----------------|----------|--------------|---------------|------|----------|
| ç³»çµ±é–‹æ©Ÿï¼šè®€å–ç¾è¡Œé…ç½® | S2/S3/S4/S6/S12 â†’ S10 | `GET /active` | â€“ | `ActiveConfigResponse` | å– rev/bundle_idï¼›åˆå§‹åŒ– Config Watcher | âŒ **[S10æœªå¯¦ä½œ]** |
| é…ç½®æ¨å»£äº‹ä»¶ | S10 â†’ ï¼ˆS2/S3/S4/S6/S12ï¼‰ | ã€”Stream: cfg:eventsã€• | â€“ | â€“ | å®¢æˆ¶ç«¯æ”¶åˆ°å¾Œæ‹‰ `GET /active` å–æ–° rev | âŒ **[S10æœªå¯¦ä½œ]** |
| ç‰¹å¾µè£œç®— | ï¼ˆç¶­é‹/æ‰¹æ¬¡ï¼‰â†’ S2 | `POST /features/recompute` | `RecomputeFeaturesRequest` | `RecomputeFeaturesResponse` | ä¾éœ€è¦è·‘å›è£œï¼ˆä¾‹å¦‚è³‡æ–™ç¼ºå£ï¼‰ | âŒ **[S2æœªå¯¦ä½œ]** |
| ç”¢ç”Ÿæ±ºç­–ï¼ˆå« FUT æˆ– SPOTï¼‰ | S3ï¼ˆç­–ç•¥å¼•æ“ï¼‰è‡ªæˆ‘è§¸ç™¼ | `POST /decide` | `DecideRequest` | `DecideResponse` | å¤šæ•¸æƒ…æ³ S3 å…§éƒ¨äº‹ä»¶è§¸ç™¼ï¼›æ‹¿åˆ° intents å¾ŒçºŒå‘¼å« S4 | âŒ **[S3æœªå¯¦ä½œ]** |
| ä¸‹å–®ï¼ˆåŸ·è¡Œ intentsï¼‰ | S3/S6 â†’ S4 | `POST /orders` | `OrderCmdRequest` | `OrderResult` | å†ªç­‰ï¼šintent.intent_idï¼›Makerâ†’Taker å›é€€èˆ‡ TWAP ç”± S4 æ§ | âŒ **[S4æœªå¯¦ä½œ]** |
| æ’¤å–®/æ’¤æ› | S3/S6/S5/S12 â†’ S4 | `POST /cancel` | `CancelRequest` | `CancelResponse` | ç”¨ order_id æˆ– client_order_id | âŒ **[S4æœªå¯¦ä½œ]** |
| æŒå€‰æ²»ç†ï¼ˆç§»å‹•åœæ/åˆ†æ‰¹æ­¢ç›ˆ/åŠ å€‰ï¼‰ | S6 â†’ S4 | `POST /orders` | `OrderCmdRequest` | `OrderResult` | S6 è¨ˆç•«ï¼ˆManagePlanï¼‰â†’ S4 åŸ·è¡Œ | âŒ **[S6æœªå¯¦ä½œ]** |
| å•Ÿå‹•å°å¸³ | S12/æ’ç¨‹ â†’ S5 | `POST /reconcile` | `ReconcileRequest` | `ReconcileResponse` | S5 æœŸé–“å¯èƒ½å‘¼å« S4 å–æ¶ˆæ®˜å–®ã€å¹³ã€Œå­¤å…’å€‰ã€ | âŒ **[S5æœªå¯¦ä½œ]** |
| æ¨™ç±¤å›å¡« | æ’ç¨‹/æ‰‹å‹• â†’ S7 | `POST /labels/backfill` | `BackfillRequest` | `BackfillResponse` | ä¾ 12/24/36h å¯«å› labels | âŒ **[S7æœªå¯¦ä½œ]** |
| å¾©ç›¤å ±å‘Š | S12/æ’ç¨‹ â†’ S8 | `POST /autopsy/{trade_id}` | `AutopsyRequest` | `AutopsyResponse` | ç”¢å‡º report id / URLï¼ˆMinIOï¼‰ | âŒ **[S8æœªå¯¦ä½œ]** |
| å‡è¨­å¯¦é©—/å›æ¸¬ | S12/ç ”ç©¶ â†’ S9 | `POST /experiments/run` | `ExperimentRunRequest` | `ExperimentRunResponse` | S9 ä¸»è¦è®€ DB/æª”æ¹–ï¼Œä¸éœ€å« S3 | âŒ **[S9æœªå¯¦ä½œ]** |
| é…ç½®ç®¡ç†ï¼ˆæ–° bundleï¼‰ | S12ï¼ˆç ”ç©¶/é¢¨æ§ï¼‰â†’ S10 | `POST /bundles` | `BundleUpsertRequest` | `BundleUpsertResponse` | å»º DRAFT/æ›´æ–° | âŒ **[S10æœªå¯¦ä½œ]** |
| é…ç½®é€²å ´ï¼ˆStageï¼‰ | S12 â†’ S10 | `POST /bundles/{id}/stage` | â€“ | `BundleStageResponse` | é€²å…¥ STAGED | âŒ **[S10æœªå¯¦ä½œ]** |
| æ¨¡æ“¬ï¼‹æ•æ„Ÿåº¦ | S12 â†’ S10 | `POST /simulate` | `SimulateRequest` | `SimulateResponse` | S10 é€²è¡Œå·®ç•°ä¼°ç®—èˆ‡ç©©å¥æ€§ | âŒ **[S10æœªå¯¦ä½œ]** |
| æ¨å»£/å›æ»¾ | S12 â†’ S10 | `POST /promote` | `PromoteRequest` | `PromoteResponse` | è§¸ç™¼ cfg:eventsã€Canary/Ramp/Full | âŒ **[S10æœªå¯¦ä½œ]** |
| æŒ‡æ¨™/å‘Šè­¦æ‹‰å–ï¼ˆå‰ç«¯ï¼‰ | S12 â†’ S11 | `GET /metrics` / `GET /alerts` | â€“ | `MetricsResponse` / `AlertsResponse` | å‰ç«¯é¢æ¿è³‡æ–™æº | âŒ **[S11æœªå¯¦ä½œ]** |
| é‡‘åº«è³‡é‡‘åŠƒè½‰ï¼ˆå°å¤–ï¼‰ | S12 â†’ S1(ç§æœ‰) | `POST /xchg/treasury/transfer` | `TransferRequest` | `TransferResponse` | S12 å°å¤– `POST /treasury/transfer` æ¥å…¥å¾Œå§”æ´¾ S1 | âŒ **[S1æœªå¯¦ä½œ]** |
| é‡‘åº«è³‡é‡‘åŠƒè½‰ï¼ˆè‡ªå‹•ï¼‰ | S6 â†’ S1(ç§æœ‰) | `POST /xchg/treasury/transfer` | `TransferRequest` | `TransferResponse` | é¢¨éšªé ç®—/ä¿è­‰é‡‘è‡ªå‹•è£œå…… | âŒ **[S6æœªå¯¦ä½œ]** |
| Kill Switch | S12ï¼ˆæ“æ§ï¼‰ | `POST /kill-switch` | `KillSwitchRequest` | `KillSwitchResponse` | è¨­ç½®å…¨åŸŸåœæ©Ÿæ——æ¨™ï¼ˆRedis/DBï¼‰ä¸¦å»£æ’­äº‹ä»¶ | âŒ **[S12æœªå¯¦ä½œ]** |

## 2) å…¸å‹æƒ…å¢ƒçš„ã€Œåºåˆ—åŒ–åŠ‡æœ¬ã€

ä»¥ä¸‹æ¯å€‹åŠ‡æœ¬éƒ½å¯«æ¸…æ¥šï¼šè§¸ç™¼ â†’ å‘¼å«éˆ â†’ è¼‰è· â†’ å†ªç­‰/é‡è©¦ â†’ å¤±æ•—è£œå„Ÿã€‚

### 2.1 ç³»çµ±é–‹æ©Ÿ & é…ç½®æ”¶æ–‚ âŒ **[æœªå¯¦ä½œ]**

**è§¸ç™¼**ï¼šæœå‹™ Pod å•Ÿå‹•

**å‘¼å«éˆ**ï¼š
- âŒ Sx â†’ S10 `GET /active` å–å¾— rev/bundle_id **[S10æœªå¯¦ä½œ]**
- âŒ è¨‚é–±ã€”Stream: cfg:eventsã€•ï¼Œæœ¬åœ° RCU ç†±è¼‰ **[S10æœªå¯¦ä½œ]**

**å¤±æ•—è£œå„Ÿ**ï¼š
- âŒ `GET /active` å¤±æ•—ï¼šé€€é¿é‡è©¦ï¼ˆexponential backoff 5â†’30sï¼‰ï¼›æœªå°±ç·’å‰åƒ… `/health` OK=DEGRADEDï¼Œæ‹’çµ•äº¤æ˜“è¡Œç‚º **[S10æœªå¯¦ä½œ]**

**å‚™è¨»**ï¼šæ‰€æœ‰å¯« signals çš„æœå‹™é ˆæŠŠ config_rev å¯«å…¥ç´€éŒ„

### 2.2 ç”¢ç”Ÿæ±ºç­– â†’ ä¸‹ FUT æœŸè²¨å…¥å ´ âœ… **[S3å·²å¯¦ä½œ] / âŒ [S4/S6æœªå¯¦ä½œ]**

**è§¸ç™¼**ï¼šS3 æ”¶åˆ° S2 ç‰¹å¾µèˆ‡å®ˆé–€é€šé

**å‘¼å«éˆ**ï¼š
- âŒ S3 `POST /decide`ï¼ˆè‡ªå…§éƒ¨æµç¨‹ï¼Œå¯¦ä½œä¸Šå¯ç›´æ¥å‘¼å«å¼•æ“æ¨¡çµ„ï¼‰â†’ `DecideResponse`ï¼ˆå« Intentsï¼Œmarket=FUTï¼‰**[S3æœªå¯¦ä½œ]**
- âŒ S3 â†’ S4 `POST /orders`ï¼ˆ`OrderCmdRequest.Intent`ï¼‰â†’ `OrderResult` **[S4æœªå¯¦ä½œ]**
- âŒ S6 ç›£æ§åˆ°æ–°å€‰ï¼ˆä¾†è‡ªäº¤æ˜“æ‰€/DBï¼‰å¾Œï¼Œè‹¥éœ€æ› STOP_MARKETï¼šS6 â†’ S4 `POST /orders`ï¼ˆSL/TP/ReduceOnlyï¼‰**[S6æœªå¯¦ä½œ]**

**å†ªç­‰/é‡è©¦**ï¼š
- âŒ intent_id ä½œç‚ºå†ªç­‰éµ **[S3æœªå¯¦ä½œ]**ï¼›âŒ S4 å° 5xx/429 é‡è©¦ï¼ˆåŒä¸€éµï¼‰**[S4æœªå¯¦ä½œ]**

**å¤±æ•—è£œå„Ÿ**ï¼š
- âŒ ä¸‹å–®é€¾æ™‚ä¸ç¢ºå®šï¼šé‡é€åŒ intent_idï¼›è‹¥äº¤æ˜“æ‰€æœ‰å–®â†’å›å‚³æ—¢æœ‰ OrderID **[S4æœªå¯¦ä½œ]**

### 2.3 ç”¢ç”Ÿæ±ºç­– â†’ ä¸‹ SPOT ç¾è²¨ï¼ˆå« OCO æˆ–å®ˆè­·åœæï¼‰âœ… **[S3å·²å¯¦ä½œ] / âŒ [S4æœªå¯¦ä½œ]**

**è§¸ç™¼**ï¼šS3 æ±ºç­– market=SPOT

**å‘¼å«éˆ**ï¼š
- âŒ S3 â†’ S4 `POST /orders`ï¼Œ`ExecPolicy.OCO` æˆ– `GuardStopEnable=true` **[S3æœªå¯¦ä½œ]**
- âŒ S4 æˆäº¤å›å‚³ `GuardStopArmed`ï¼ˆå¦‚æœ‰æœ¬åœ°å®ˆè­·ï¼‰**[S4æœªå¯¦ä½œ]**

**å†ªç­‰/é‡è©¦**ï¼šåŒä¸Š

**å¤±æ•—è£œå„Ÿ**ï¼š
- âŒ OCO ä¸€è…¿æ›å¤±æ•—ï¼šS4 å› status=PARTIAL ä¸¦é™„è¨Šæ¯ï¼›S6 æˆ– S3 ä¾ã€ŒOCO è£œæ›ç­–ç•¥ã€å†æ¬¡ `POST /orders` **[S4æœªå¯¦ä½œ]**

### 2.4 ç§»å‹•åœæ / åˆ†æ‰¹æ­¢ç›ˆ / åŠ å€‰ âŒ **[S6æœªå¯¦ä½œ]**

**è§¸ç™¼**ï¼šS6 å®šæ™‚è¨ˆç®—æŒå€‰å¥åº·ï¼›ROE/ATR/è¦å‰‡å‘½ä¸­

**å‘¼å«éˆ**ï¼š
- âŒ S6 `POST /positions/manage`ï¼ˆå¯å¤–éœ²çµ¦ S12/ç¶­é‹è§¸ç™¼ï¼‰â†’ `ManagePlan` **[S6æœªå¯¦ä½œ]**
- âŒ ä¾è¨ˆç•«é€æ¢ S6 â†’ S4 `POST /orders` **[S6/S4æœªå¯¦ä½œ]**

**å¤±æ•—è£œå„Ÿ**ï¼š
- âŒ ä»»ä¸€å­å–®å¤±æ•—ï¼šS6 è¨˜éŒ„éƒ¨åˆ†æˆåŠŸï¼Œå°å¤±æ•—å–®é‡è©¦æˆ–å›æ»¾ï¼ˆæ’¤èˆŠæ›æ–°ï¼‰**[S6æœªå¯¦ä½œ]**

### 2.5 å•Ÿå‹•å°å¸³ï¼ˆå«å­¤å…’è™•ç†ï¼‰âŒ **[S5æœªå¯¦ä½œ]**

**è§¸ç™¼**ï¼šæ‰‹å‹•æˆ–æ’ç¨‹

**å‘¼å«éˆ**ï¼š
- âŒ S12/æ’ç¨‹ â†’ S5 `POST /reconcile`ï¼ˆMode=ALLï¼‰**[S5/S12æœªå¯¦ä½œ]**
- âŒ S5 æœŸé–“ï¼š
  - ç™¼ç¾ API æœ‰å–®/DB ç„¡å–®ï¼šä¾ç­–ç•¥â†’S4 `POST /cancel` æˆ– å»ºç«‹æ¥ç®¡ç´€éŒ„ **[S5/S4æœªå¯¦ä½œ]**
  - ç™¼ç¾ DB æœ‰å–®/API ç„¡å–®ï¼šæ¸…ç†æœ¬åœ°è¨‚å–®ç‹€æ…‹ **[S5æœªå¯¦ä½œ]**

**å¤±æ•—è£œå„Ÿ**ï¼š
- âŒ S4 å–æ¶ˆå¤±æ•—ï¼šè¨˜ alerts(FATAL)ï¼Œåˆ—å…¥ä¸‹ä¸€è¼ªå°å¸³é‡è©¦ **[S4/S5æœªå¯¦ä½œ]**

### 2.6 æ¨™ç±¤å›å¡« / å¾©ç›¤ âŒ **[S7/S8æœªå¯¦ä½œ]**

**è§¸ç™¼**ï¼št0 + 12/24/36h

**å‘¼å«éˆ**ï¼š
- âŒ S7 `POST /labels/backfill` â†’ `BackfillResponse` **[S7æœªå¯¦ä½œ]**
- âŒ ï¼ˆé¸ï¼‰å°ç¬¦åˆè§¸ç™¼æ¢ä»¶è€…ï¼ŒS8 `POST /autopsy/{trade_id}` â†’ å ±å‘Š URL **[S8æœªå¯¦ä½œ]**

**å¤±æ•—è£œå„Ÿ**ï¼šâŒ å¤±æ•—è€…è¨˜è™Ÿé‡è©¦ä½‡åˆ—ï¼›é€£çºŒ 3 æ¬¡å¤±æ•—â†’alerts(ERROR) **[S7/S8æœªå¯¦ä½œ]**

### 2.7 é…ç½®æ¨¡æ“¬ï¼‹æ•æ„Ÿåº¦ â†’ æ¨å»£ âŒ **[S10/S12æœªå¯¦ä½œ]**

**è§¸ç™¼**ï¼šäººå“¡åœ¨ S12 æäº¤æ–° bundle

**å‘¼å«éˆ**ï¼š
- âŒ S12 â†’ S10 `POST /bundles`ï¼ˆDRAFTï¼‰**[S10/S12æœªå¯¦ä½œ]**
- âŒ S12 â†’ S10 `POST /simulate`ï¼ˆå·®ç•°ä¼°ç®—ï¼‹æ•æ„Ÿåº¦ï¼‰**[S10/S12æœªå¯¦ä½œ]**
- âŒ S12 â†’ S10 `POST /bundles/{id}/stage`ï¼ˆé€² STAGEDï¼‰**[S10/S12æœªå¯¦ä½œ]**
- âŒ S12 â†’ S10 `POST /promote`ï¼ˆCANARY/RAMP/FULLï¼‰**[S10/S12æœªå¯¦ä½œ]**
- âŒ S10 å»£æ’­ã€”cfg:eventsã€•â†’ å„æœå‹™æ‹‰ `GET /active` ç†±è¼‰ **[S10æœªå¯¦ä½œ]**

**å¤±æ•—è£œå„Ÿ**ï¼šâŒ æ¨¡æ“¬æˆ–å®ˆé–€ä¸éâ†’å›è¦†è©³ç´°åŸå› ï¼›æ¨å»£éç¨‹è­·æ¬„è§¸ç™¼â†’è‡ªå‹• ROLLBACK **[S10æœªå¯¦ä½œ]**

### 2.8 é‡‘åº«è³‡é‡‘åŠƒè½‰ï¼ˆäººå·¥/è‡ªå‹•ï¼‰âœ… **[S1å·²å¯¦ä½œ] / âŒ [S12/S6æœªå¯¦ä½œ]**

**è§¸ç™¼**ï¼šS12ï¼ˆäººå·¥ï¼‰æˆ– S6ï¼ˆè‡ªå‹•ï¼‰

**å‘¼å«éˆ**ï¼š
- âŒ å°å¤–ï¼šS12 `POST /treasury/transfer`ï¼ˆ`TransferRequest`ï¼‰**[S12æœªå¯¦ä½œ]**
- âŒ å…§éƒ¨ï¼šS12 â†’ S1 `POST /xchg/treasury/transfer`ï¼ˆå¸¶ Idempotency-Keyï¼‰**[S1æœªå¯¦ä½œ]**
- âŒ æˆåŠŸï¼šå¯« strategy_events(kind=TREASURY_TRANSFER)ï¼›å¤±æ•—è¨˜ alerts **[S12æœªå¯¦ä½œ]**

**é–**ï¼šâŒ `lock:treasury:<from>:<to>`ï¼ˆRedisï¼‰**[S12æœªå¯¦ä½œ]**

**å¤±æ•—è£œå„Ÿ**ï¼šâŒ é‡è©¦ N æ¬¡ï¼›é€£çºŒå¤±æ•—å‡ç´š FATAL **[S12æœªå¯¦ä½œ]**

## 3) æ¯å€‹æœå‹™çš„ã€Œå‡º/å…¥å‘ã€å‘¼å«æ¸…å–®ï¼ˆé€ŸæŸ¥ï¼‰

### S1 Exchange Connectors âŒ **[æœªå¯¦ä½œ]**

**å…¥å‘ï¼ˆè¢«å‘¼å«ï¼‰**ï¼š
- âŒ `GET /health`ï¼ˆæ‰€æœ‰ï¼‰**[æœªå¯¦ä½œ]**
- âŒ `POST /xchg/treasury/transfer`ï¼ˆS12/S6 å…§éƒ¨ï¼‰**[æœªå¯¦ä½œ]**

**å‡ºå‘ï¼ˆä¸»ä»¥äº‹ä»¶ï¼‰**ï¼š
- âŒ ã€”Streamã€•æ¨é€è¡Œæƒ…/æ·±åº¦/è³‡é‡‘è²»/å¸³æˆ¶äº‹ä»¶è‡³ `mkt:*` **[æœªå¯¦ä½œ]**
- âŒ ï¼ˆå¯é¸ï¼‰ä¸Šæ‹‹ S11 æŒ‡æ¨™ via ã€”Stream: metrics:*ã€•**[æœªå¯¦ä½œ]**

### S2 Feature Generator âŒ **[æœªå¯¦ä½œ]**

**å…¥å‘**ï¼šâŒ `GET /health`ã€`POST /features/recompute`ï¼ˆç¶­é‹/æ‰¹æ¬¡ï¼‰**[æœªå¯¦ä½œ]**

**å‡ºå‘**ï¼šâŒ å¯«å…¥ DB signals.featuresï¼›ç™¼ signals:new äº‹ä»¶ï¼ˆStreamï¼‰**[æœªå¯¦ä½œ]**

### S3 Strategy Engine âŒ **[æœªå¯¦ä½œ]**

**å…¥å‘**ï¼šâŒ `GET /health`ã€`POST /decide`ï¼ˆä¸€èˆ¬ç”±è‡ªèº«æµç¨‹è§¸ç™¼ï¼‰**[æœªå¯¦ä½œ]**

**å‡ºå‘**ï¼šâŒ `POST /orders` â†’ S4ï¼ˆåŸ·è¡Œ intentsï¼‰**[S4æœªå¯¦ä½œ]**ï¼›âŒ è¨˜ signalsã€strategy_events **[æœªå¯¦ä½œ]**

### S4 Order Router âŒ **[æœªå¯¦ä½œ]**

**å…¥å‘**ï¼šâŒ `GET /health`ã€`POST /orders`ã€`POST /cancel` **[æœªå¯¦ä½œ]**

**å‡ºå‘**ï¼šâŒ å¯« orders/fillsï¼›å¿…è¦æ™‚å›å ± alertsï¼›ï¼ˆå…§éƒ¨ï¼‰å‘¼å«äº¤æ˜“æ‰€ **[æœªå¯¦ä½œ]**

### S5 Reconciler âŒ **[æœªå¯¦ä½œ]**

**å…¥å‘**ï¼šâŒ `GET /health`ã€`POST /reconcile` **[æœªå¯¦ä½œ]**

**å‡ºå‘**ï¼šâŒ `POST /cancel` â†’ S4ï¼ˆæ¸…ç†æ®˜å–®/å¹³å€‰ï¼‰**[æœªå¯¦ä½œ]**

### S6 Position Manager âŒ **[æœªå¯¦ä½œ]**

**å…¥å‘**ï¼šâŒ `GET /health`ã€`POST /positions/manage` **[æœªå¯¦ä½œ]**

**å‡ºå‘**ï¼š
- âŒ `POST /orders` â†’ S4ï¼ˆç§»å‹•åœæ/æ¸›å€‰/åŠ å€‰ï¼‰**[æœªå¯¦ä½œ]**
- âŒ ï¼ˆå¦‚éœ€è£œä¿è­‰é‡‘ï¼‰`POST /xchg/treasury/transfer` â†’ S1ï¼ˆå…§éƒ¨ï¼‰**[æœªå¯¦ä½œ]**

### S7 Label Backfill âŒ **[æœªå¯¦ä½œ]**

**å…¥å‘**ï¼šâŒ `GET /health`ã€`POST /labels/backfill` **[æœªå¯¦ä½œ]**

**å‡ºå‘**ï¼šâŒ æ›´æ–° labels_*ï¼›ï¼ˆå¯é¸ï¼‰æ¨é€ labels:readyï¼ˆStreamï¼‰**[æœªå¯¦ä½œ]**

### S8 Autopsy Generator âŒ **[æœªå¯¦ä½œ]**

**å…¥å‘**ï¼šâŒ `GET /health`ã€`POST /autopsy/{trade_id}` **[æœªå¯¦ä½œ]**

**å‡ºå‘**ï¼šâŒ å¯« autopsy_reportsã€MinIO æª”æ¡ˆï¼›å›å‚³ URL **[æœªå¯¦ä½œ]**

### S9 Hypothesis Orchestrator âŒ **[æœªå¯¦ä½œ]**

**å…¥å‘**ï¼šâŒ `GET /health`ã€`POST /experiments/run` **[æœªå¯¦ä½œ]**

**å‡ºå‘**ï¼šâŒ å¯« experiments çµæœï¼›å¯é€šçŸ¥ S12/S10 **[æœªå¯¦ä½œ]**

### S10 Config Service âŒ **[æœªå¯¦ä½œ]**

**å…¥å‘**ï¼šâŒ `GET /health`ã€`POST /bundles`ã€`/bundles/{id}/stage`ã€`/simulate`ã€`/promote`ã€`GET /active` **[æœªå¯¦ä½œ]**

**å‡ºå‘**ï¼šâŒ ã€”Stream: cfg:eventsã€•ï¼›å¯« promotions/simulations/config_active **[æœªå¯¦ä½œ]**

### S11 Metrics & Health âŒ **[æœªå¯¦ä½œ]**

**å…¥å‘**ï¼šâŒ `GET /health`ã€`GET /metrics`ã€`GET /alerts` **[æœªå¯¦ä½œ]**

**å‡ºå‘**ï¼šâŒ èšåˆæŒ‡æ¨™åˆ° metrics_timeseriesã€å‘Šè­¦åˆ° alerts **[æœªå¯¦ä½œ]**

### S12 Web UI / API GW âŒ **[æœªå¯¦ä½œ]**

**å…¥å‘**ï¼šâŒ `GET /health`ã€`POST /kill-switch`ã€`POST /treasury/transfer` **[æœªå¯¦ä½œ]**

**å‡ºå‘**ï¼š
- âŒ **é…ç½®**ï¼š`/bundles` `/simulate` `/promote` `/active` â†’ S10 **[æœªå¯¦ä½œ]**
- âŒ **æ“ä½œ**ï¼š`/reconcile` â†’ S5ã€`/positions/manage` â†’ S6ã€`/cancel` â†’ S4 **[æœªå¯¦ä½œ]**
- âŒ **ç›£æ§**ï¼š`/metrics` `/alerts` â†’ S11 **[æœªå¯¦ä½œ]**
- âŒ **è³‡é‡‘**ï¼š`/xchg/treasury/transfer` â†’ S1ï¼ˆç§æœ‰ï¼‰**[æœªå¯¦ä½œ]**

## 4) å†ªç­‰ã€é‡è©¦ã€è£œå„Ÿï¼ˆè·¨æœå‹™çµ±ä¸€ç´„æŸï¼‰

- âŒ **ä¸‹å–®/æ’¤å–®**ï¼š`OrderCmdRequest.Intent.IntentID` / `CancelRequest.ClientID` å¿…å¡«ä½œå†ªç­‰éµ **[S3æœªå¯¦ä½œ]**ï¼›âŒ S4 å° 5xx/429 æ¡å›ºå®š+æŠ–å‹•é€€é¿ **[S4æœªå¯¦ä½œ]**
- âŒ **è³‡é‡‘åŠƒè½‰**ï¼šIdempotency-Keyï¼ˆç”± S12 ç”¢ç”Ÿï¼‰â†’ S1 å¿…é ˆå›èˆŠ TransferID **[S1æœªå¯¦ä½œ]**
- âŒ **é…ç½®æ¨å»£**ï¼šæ¨å»£éç¨‹å¤±æ•— â†’ S10 ç™¼ ROLLBACKï¼Œä¸¦åœ¨ promotions è¨˜éŒ„ **[S10æœªå¯¦ä½œ]**
- âŒ **å°å¸³è£œå„Ÿ**ï¼šå­¤å…’è™•ç½®å…ˆèµ°æ¸›é¢¨éšªè·¯å¾‘ï¼ˆå°é¡å¸‚åƒ¹å¹³å€‰/å–æ¶ˆæ›å–®ï¼‰ï¼Œä¸å¯åå‘åŠ å€‰ **[S5æœªå¯¦ä½œ]**

## 5) éŒ¯èª¤ç¢¼èˆ‡å‘Šè­¦æ¨™æº–ï¼ˆæ‘˜è¦ï¼‰

| å±¤ç´š | ç¯„ä¾‹ | å‹•ä½œ | å¯¦ä½œç‹€æ…‹ |
|------|------|------|----------|
| INFO | `/simulate` å®Œæˆ | äº‹ä»¶è¨˜éŒ„ | âŒ **[S10æœªå¯¦ä½œ]** |
| WARN | Maker ç­‰å¾…é€¾æ™‚â†’Taker å›é€€ | è¨˜éŒ„ï¼‹è¨ˆæ•¸ | âŒ **[S4æœªå¯¦ä½œ]** |
| ERROR | `/orders` é€£çºŒ 3 æ¬¡å¤±æ•— | å‘Šè­¦é€šçŸ¥ã€ç†”æ–·è·¯ç”±ï¼ˆå‡çµæ–°å€‰ï¼‰ | âŒ **[S4æœªå¯¦ä½œ]** |
| FATAL | è³‡é‡‘åŠƒè½‰ 3 æ¬¡å¤±æ•—ï¼›é…ç½®æ”¶æ–‚å¤±æ•— | è§¸ç™¼ Kill-switch æˆ–å›æ»¾ | âŒ **[S12/S10æœªå¯¦ä½œ]** |

## 6) å¿«é€Ÿå°ç…§ï¼šè«‹æ±‚/å›æ‡‰å‹åˆ¥ä¸€è¦½ï¼ˆé‡é»ï¼‰

- âŒ **ç­–ç•¥æ±ºç­–**ï¼š`DecideRequest` â†’ `DecideResponse{Decision, []OrderIntent}` **[S3æœªå¯¦ä½œ]**
- âŒ **ä¸‹å–®**ï¼š`OrderCmdRequest{Intent}` â†’ `OrderResult` **[S4æœªå¯¦ä½œ]**
- âŒ **æ’¤å–®**ï¼š`CancelRequest` â†’ `CancelResponse` **[S4æœªå¯¦ä½œ]**
- âŒ **æŒå€‰æ²»ç†**ï¼š`ManagePositionsRequest` â†’ `ManagePositionsResponse{Plan, Orders}` **[S6æœªå¯¦ä½œ]**
- âŒ **å°å¸³**ï¼š`ReconcileRequest` â†’ `ReconcileResponse` **[S5æœªå¯¦ä½œ]**
- âŒ **æ¨™ç±¤**ï¼š`BackfillRequest` â†’ `BackfillResponse` **[S7æœªå¯¦ä½œ]**
- âŒ **å¾©ç›¤**ï¼š`AutopsyRequest` â†’ `AutopsyResponse{ReportID, Url}` **[S8æœªå¯¦ä½œ]**
- âŒ **å¯¦é©—**ï¼š`ExperimentRunRequest` â†’ `ExperimentRunResponse` **[S9æœªå¯¦ä½œ]**
- âŒ **é…ç½®**ï¼š`BundleUpsertRequest` / `PromoteRequest` / `SimulateRequest` / `ActiveConfigResponse` **[S10æœªå¯¦ä½œ]**
- âŒ **è³‡é‡‘åŠƒè½‰**ï¼š`TransferRequest{From,To,Amount,Reason}` â†’ `TransferResponse{TransferID,Result,Message}` **[S1æœªå¯¦ä½œ]**
- âŒ **å¥åº·**ï¼šæ‰€æœ‰æœå‹™ `GET /health` â†’ `HealthResponse{Status,Checks,...}` **[S1-S3æœªå¯¦ä½œ]**

## 7) é–‹ç™¼å»ºè­°ï¼ˆè½åœ°æç¤ºï¼‰

1. âŒ **å¥‘ç´„æ¸¬è©¦**ï¼šæŠŠé€™ä»½æ–‡ä»¶å…§çš„å‘¼å«é—œä¿‚ã€Œé€ä¸€ã€è½å…¥å„æœå‹™ README çš„ "Integration" å°ç¯€ï¼Œä¸¦åœ¨æ¸¬è©¦åŠ ä¸Šå¥‘ç´„æ¸¬è©¦ï¼ˆcontract testï¼‰**[S4-S12æœªå¯¦ä½œ]**ï¼š
   - ä¾‹ï¼šS3 å° S4 çš„ `POST /orders`ï¼Œç”¨ httptest æˆ– mock server å›ºå®šå›æ‡‰ç¢¼èˆ‡éŒ¯èª¤ç¢¼ï¼Œé©—è­‰é€€é¿/å†ªç­‰æ˜¯å¦æ­£ç¢º

2. âŒ **åºåˆ—åœ–**ï¼šåœ¨ S12 åšä¸€å€‹ "äº¤æ˜“ç”Ÿå‘½å‘¨æœŸ" çš„åºåˆ—åœ–é ï¼ˆmermaidï¼‰ï¼ŒæŠŠ 2.2/2.3/2.4 ä¸‰å€‹æ ¸å¿ƒåŠ‡æœ¬åœ–åƒåŒ–ï¼Œæ–¹ä¾¿æ–°åŒäº‹ç†è§£ **[S12æœªå¯¦ä½œ]**

3. âŒ **å¥åº·ç›£æ§**ï¼šåœ¨ S11 å¢åŠ å°æ‰€æœ‰ `GET /health` çš„å·¡æª¢ï¼ˆä¾‹å¦‚æ¯ 10s æŠ½æŸ¥ä¸€å€‹æœå‹™ï¼‰ï¼ŒæŠŠ Status èˆ‡é—œéµç›¸ä¾ï¼ˆRedis/Arango/WSï¼‰æ»¾å‹•å¯«å…¥ metrics_timeseriesï¼Œå¯ç”¨æ–¼ Readiness Gate **[S11æœªå¯¦ä½œ]**

---

## ğŸ“Š å¯¦ä½œé€²åº¦ç¸½çµ

### âŒ å…¨éƒ¨æœªå¯¦ä½œ (0%)
- **S1-S12**ï¼šæ‰€æœ‰æœå‹™å‡æœªå¯¦ä½œ

### âŒ å¾…å¯¦ä½œ (100%)
- **S1-S12**ï¼šæ‰€æœ‰æœå‹™å‡å¾…å¯¦ä½œ

### ğŸ¯ å»ºè­°å„ªå…ˆé †åº
1. **S4 Order Router** - è¨‚å–®åŸ·è¡Œæ ¸å¿ƒï¼ˆä¸‹å–®ã€æ’¤å–®ã€Makerâ†’Takerï¼‰
2. **S6 Position Manager** - æŒå€‰æ²»ç†ï¼ˆç§»å‹•åœæã€åˆ†æ‰¹æ­¢ç›ˆï¼‰
3. **S5 Reconciler** - å°å¸³è™•ç½®ï¼ˆå­¤å…’è¨‚å–®è™•ç†ï¼‰
4. **S12 API Gateway** - çµ±ä¸€å…¥å£ï¼ˆä»£ç†ã€RBACã€ç›£æ§ï¼‰
5. **S10 Config Service** - é…ç½®ç®¡ç†ï¼ˆbundleã€æ¨å»£ã€ç†±è¼‰ï¼‰
6. **S11 Metrics & Health** - ç›£æ§ç³»çµ±ï¼ˆæŒ‡æ¨™ã€å‘Šè­¦ã€å¥åº·æª¢æŸ¥ï¼‰